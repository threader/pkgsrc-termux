$NetBSD: patch-CVE-2014-8137,v 1.1 2015/03/11 20:58:26 spz Exp $

patch for CVE-2014-8137 taken from
http://pkgs.fedoraproject.org/cgit/jasper.git/tree/jasper-CVE-2014-8137.patch

--- jasper/src/libjasper/base/jas_icc.c.orig	2012-08-08 08:01:36.000000000 +0000
+++ jasper/src/libjasper/base/jas_icc.c
@@ -1024,7 +1024,6 @@ static int jas_icccurv_input(jas_iccattr
 	return 0;
 
 error:
-	jas_icccurv_destroy(attrval);
 	return -1;
 }
 
@@ -1144,7 +1143,6 @@ static int jas_icctxtdesc_input(jas_icca
 #endif
 	return 0;
 error:
-	jas_icctxtdesc_destroy(attrval);
 	return -1;
 }
 
@@ -1223,8 +1221,6 @@ static int jas_icctxt_input(jas_iccattrv
 		goto error;
 	return 0;
 error:
-	if (txt->string)
-		jas_free(txt->string);
 	return -1;
 }
 
@@ -1349,7 +1345,6 @@ static int jas_icclut8_input(jas_iccattr
 		goto error;
 	return 0;
 error:
-	jas_icclut8_destroy(attrval);
 	return -1;
 }
 
@@ -1520,7 +1515,6 @@ static int jas_icclut16_input(jas_iccatt
 		goto error;
 	return 0;
 error:
-	jas_icclut16_destroy(attrval);
 	return -1;
 }
 
--- jasper/src/libjasper/jp2/jp2_dec.c.orig	2012-08-08 08:01:36.000000000 +0000
+++ jasper/src/libjasper/jp2/jp2_dec.c
@@ -325,7 +325,10 @@ jas_image_t *jp2_decode(jas_stream_t *in
 	case JP2_COLR_ICC:
 		iccprof = jas_iccprof_createfrombuf(dec->colr->data.colr.iccp,
 		  dec->colr->data.colr.iccplen);
-		assert(iccprof);
+		if (!iccprof) {
+			jas_eprintf("error: failed to parse ICC profile\n");
+			goto error;
+		}
 		jas_iccprof_gethdr(iccprof, &icchdr);
 		if (jas_getdbglevel() >= 1) {
 			jas_eprintf("ICC Profile CS %08x\n", icchdr.colorspc);
