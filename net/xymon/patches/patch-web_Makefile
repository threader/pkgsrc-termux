$NetBSD: patch-web_Makefile,v 1.1 2017/09/28 10:40:35 spz Exp $

allow hardening

--- web/Makefile.orig	2015-11-01 18:17:08.000000000 +0000
+++ web/Makefile
@@ -57,102 +57,102 @@ cgiwrap.o: cgiwrap.c
 	$(CC) $(CFLAGS) -DXYMONHOME=\"$(XYMONHOME)\" -c -o $@ $<
 
 cgiwrap: $(CGIWRAPOBJS) $(XYMONCOMMLIB)
-	$(CC) $(CFLAGS) -o $@ $(CGIWRAPOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(CGIWRAPOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
 
 history.cgi: $(HISTOBJS) $(XYMONCOMMLIB)
-	$(CC) $(CFLAGS) -o $@ $(HISTOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(HISTOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
 
 eventlog.cgi: $(EVENTLOGOBJS) $(XYMONCOMMLIB)
-	$(CC) $(CFLAGS) -o $@ $(EVENTLOGOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(EVENTLOGOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
 
 report.cgi: $(REPOBJS) $(XYMONCOMMLIB)
-	$(CC) $(CFLAGS) -o $@ $(REPOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(REPOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
 
 reportlog.cgi: $(REPLOGOBJS) $(XYMONCOMMLIB)
-	$(CC) $(CFLAGS) -o $@ $(REPLOGOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(REPLOGOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
 
 snapshot.cgi: $(SNAPOBJS) $(XYMONCOMMLIB)
-	$(CC) $(CFLAGS) -o $@ $(SNAPOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(SNAPOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
 
 findhost.cgi: $(FINDHOSTOBJS) $(XYMONCOMMLIB)
-	$(CC) $(CFLAGS) -o $@ $(FINDHOSTOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(FINDHOSTOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
 
 csvinfo.cgi: $(CSVINFOOBJS) $(XYMONCOMMLIB)
-	$(CC) $(CFLAGS) -o $@ $(CSVINFOOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(CSVINFOOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
 
 acknowledge.cgi: $(ACKCGIOBJS) $(XYMONCOMMLIB)
-	$(CC) $(CFLAGS) -o $@ $(ACKCGIOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(ACKCGIOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
 
 xymonpage: $(WEBPAGEOBJS) $(XYMONCOMMLIB)
-	$(CC) $(CFLAGS) -o $@ $(WEBPAGEOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(WEBPAGEOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
 
 datepage.cgi: $(DATEPAGEOBJS) $(XYMONCOMMLIB)
-	$(CC) $(CFLAGS) -o $@ $(DATEPAGEOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(DATEPAGEOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
 
 showgraph.o: showgraph.c
 	$(CC) $(CFLAGS) $(PCREINCDIR) $(RRDDEF) $(RRDINCDIR) -c -o $@ $<
 
 # Need NETLIBS on Solaris for getservbyname(), called by parse_url()
 showgraph.cgi: $(SHOWGRAPHOBJS) $(XYMONCOMMLIB)
-	$(CC) $(CFLAGS) -o $@ $(RPATHOPT) $(SHOWGRAPHOBJS) $(XYMONCOMMLIBS) $(PCRELIBS) $(RRDLIBS)
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(RPATHOPT) $(SHOWGRAPHOBJS) $(XYMONCOMMLIBS) $(PCRELIBS) $(RRDLIBS)
 
 svcstatus.cgi: $(SVCSTATUSOBJS) $(XYMONCOMMLIB)
-	$(CC) $(CFLAGS) -o $@ $(SVCSTATUSOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(SVCSTATUSOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
 
 enadis.cgi: $(ENADISOBJS) $(XYMONCOMMLIB)
-	$(CC) $(CFLAGS) -o $@ $(ENADISOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(ENADISOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
 
 statusreport.cgi: $(STATUSREPOBJS) $(XYMONCOMMLIB)
-	$(CC) $(CFLAGS) -o $@ $(STATUSREPOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(STATUSREPOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
 
 confreport.cgi: $(CONFREPOBJS) $(XYMONCOMMLIB)
-	$(CC) $(CFLAGS) -o $@ $(CONFREPOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(CONFREPOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
 
 criticalview.cgi: $(CRITVIEWOBJS) $(XYMONCOMMLIB)
-	$(CC) $(CFLAGS) -o $@ $(RPATHOPT) $(CRITVIEWOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(RPATHOPT) $(CRITVIEWOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
 
 criticalview.o: criticalview.c
 	$(CC) $(CFLAGS) $(PCREINCDIR) -c -o $@ $<
 
 criticaleditor.cgi: $(CRITEDITOBJS) $(XYMONCOMMLIB)
-	$(CC) $(CFLAGS) -o $@ $(RPATHOPT) $(CRITEDITOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(RPATHOPT) $(CRITEDITOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
 
 ackinfo.cgi: $(ACKINFOOBJS) $(XYMONCOMMLIB)
-	$(CC) $(CFLAGS) -o $@ $(RPATHOPT) $(ACKINFOOBJS) $(XYMONCOMMLIBS)
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(RPATHOPT) $(ACKINFOOBJS) $(XYMONCOMMLIBS)
 
 boilerplate.cgi: $(BOILERPLATEOBJS) $(XYMONCOMMLIB)
-	$(CC) $(CFLAGS) -o $@ $(RPATHOPT) $(BOILERPLATEOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(RPATHOPT) $(BOILERPLATEOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
 
 hostgraphs.cgi: $(HOSTGRAPHSOBJS) $(XYMONCOMMLIB)
-	$(CC) $(CFLAGS) -o $@ $(RPATHOPT) $(HOSTGRAPHSOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(RPATHOPT) $(HOSTGRAPHSOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
 
 ghostlist.cgi: $(GHOSTOBJS) $(XYMONCOMMLIB)
-	$(CC) $(CFLAGS) -o $@ $(RPATHOPT) $(GHOSTOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(RPATHOPT) $(GHOSTOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
 
 notifications.cgi: $(NOTIFYOBJS) $(XYMONCOMMLIB)
-	$(CC) $(CFLAGS) -o $@ $(RPATHOPT) $(NOTIFYOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(RPATHOPT) $(NOTIFYOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
 
 acknowledgements.cgi: $(ACKNOWLEDGEOBJS) $(XYMONCOMMLIB)
-	$(CC) $(CFLAGS) -o $@ $(RPATHOPT) $(ACKNOWLEDGEOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(RPATHOPT) $(ACKNOWLEDGEOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
 
 hostlist.cgi: $(HOSTLISTOBJS) $(XYMONCOMMLIB)
-	$(CC) $(CFLAGS) -o $@ $(RPATHOPT) $(HOSTLISTOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(RPATHOPT) $(HOSTLISTOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
 
 perfdata.o: perfdata.c
 	$(CC) $(CFLAGS) $(PCREINCDIR) $(RRDDEF) $(RRDINCDIR) -c -o $@ $<
 
 # Need -lm on perfdata because it refers to isnan()
 perfdata.cgi: $(PERFDATAOBJS) $(XYMONCOMMLIB)
-	$(CC) $(CFLAGS) -o $@ $(RPATHOPT) $(PERFDATAOBJS) $(XYMONCOMMLIBS) $(PCRELIBS) $(RRDLIBS) -lm
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(RPATHOPT) $(PERFDATAOBJS) $(XYMONCOMMLIBS) $(PCRELIBS) $(RRDLIBS) -lm
 
 useradm.cgi: $(USERADMOBJS) $(XYMONCOMMLIB)
-	$(CC) $(CFLAGS) -o $@ $(RPATHOPT) $(USERADMOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(RPATHOPT) $(USERADMOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
 
 chpasswd.cgi: $(CHPASSWDOBJS) $(XYMONCOMMLIB)
-	$(CC) $(CFLAGS) -o $@ $(RPATHOPT) $(CHPASSWDOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(RPATHOPT) $(CHPASSWDOBJS) $(XYMONCOMMLIBS) $(PCRELIBS)
 
 appfeed.cgi: $(APPFEEDOBJS) $(XYMONLIB)
-	$(CC) $(CFLAGS) -o $@ $(RPATHOPT) $(APPFEEDOBJS) $(XYMONCOMMLIBS) $(XYMONLIBS) $(PCRELIBS)
+	$(CC) $(CFLAGS) $(LDFLAGS) -o $@ $(RPATHOPT) $(APPFEEDOBJS) $(XYMONCOMMLIBS) $(XYMONLIBS) $(PCRELIBS)
 
 
 %.o: %.c
